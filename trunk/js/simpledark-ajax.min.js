function ajaxSubmitComment(){function c(d){var e;if(scriptParams.threadcmnts){var f=jQuery("#respond");e=f.next();if(e.length==0){e=jQuery("<ul></ul>");e.attr("class","children");f.after(e)}else if(e.attr("id")=="pings")e=jQuery("ol.comment-list");e.append(d+"</li>")}else e=jQuery("ol.comment-list").append(d);d=e.children("li:last");fadingSlideDown(d);d.ScrollTo(500)}var a=jQuery("#comment-form"),b={};b.author=a.find("#author").val();b.email=a.find("#email").val();b.url=a.find("#url").val();b.comment= a.find("#comment").val();b.comment_post_ID=a.find("#comment_post_ID").val();b.comment_parent=a.find("#comment_parent").val();jQuery.ajax({url:scriptParams.tmpldir+"/ajax-comments-post.php",type:"POST",data:b,dataType:"html",beforeSend:function(){jQuery(".fade").stop().fadeOut(500,function(){jQuery(this).remove()});jQuery("#author, #email, #url, #comment, .entry .textbox, #submit-button").attr("disabled","disabled").animate({opacity:0.5},500);jQuery("#submit-button").after('<span class="processing"></span>')}, complete:function(){jQuery("#comment-form span.processing").remove()},success:function(d){var e=d.split("<!-- AJAX Comment Data Separator --\>");!jQuery("ol.comment-list").length>0?jQuery("#comments").append('<ol class="comment-list"></ol>').find("p.message").animate({opacity:0,height:0,marginBottom:0},500,function(){jQuery(this).remove();c(e[0])}):c(e[0]);jQuery("#comment").val("");var f=jQuery(".comment-count");f.animate({opacity:0},500,function(){jQuery(this).text(f.text()-0+1).animate({opacity:1}, 500).removeAttr("style")});window.RCJS&&RCJS.page(scriptParams.blogurl,scriptParams.rcparams,0,"Loading");showMessage(e[1],function(){jQuery("#author, #email, #url, #comment, .entry .textbox, #submit-button").animate({opacity:1},500).removeAttr("style").removeAttr("disabled")})},error:function(d){showError(d.responseText,function(){jQuery("#author, #email, #url, #comment, .entry .textbox, #submit-button").animate({opacity:1},500).removeAttr("style").removeAttr("disabled")})}})} function ajaxGetComment(c,a,b){jQuery.ajax({url:scriptParams.blogurl+"?action=cget_ajax&id="+c,type:"get",dataType:"html",beforeSend:function(){a.append('<span class="processing"></span>').css({textAlign:"center",paddingTop:10,paddingBottom:10,backgroundColor:"#222",width:240},200)},complete:function(){a.find(".processing").remove()},success:function(d){var e=jQuery(d);a.fadeOut(200,function(){a.children().remove();a.append(e.children().clone());a.addClass(e.attr("class")).css({textAlign:"",padding:"", backgroundColor:"",width:""}).find(".actions").remove();a.fadeIn(200,function(){b&&typeof b=="function"&&b()})})},error:function(d){a.css("line-height","16px").append('<p class="ajax-comment-error">'+d.responseText+"</p>")}})}function ajaxPaginateComments(c){jQuery.ajax({url:c,type:"get",dataType:"html",beforeSend:commentPaginating,complete:commentPaginateComplete,success:commentPaginateSuccess,error:commentPaginateError})}var commentNavs; function commentPaginating(){jQuery(".fade").stop().fadeOut(500,function(){jQuery(this).remove()});commentNavs=jQuery(".commentnavi a, .commentnavi span").detach();jQuery(".commentnavi").append('<span class="processing"></span>')}function commentPaginateComplete(){} function commentPaginateSuccess(c){var a=c.split("<!-- AJAX Comment Paginate Data Separator --\>");jQuery(".comment-list, .commentnavi").animate({opacity:0,height:0},500,function(){jQuery(this).empty();jQuery(".comment-list").html(a[0]);jQuery(".commentnavi").html(a[1]);jQuery(this).each(function(){fadingSlideDown(jQuery(this),function(){jQuery("#comments").ScrollTo(500)})})})} function commentPaginateError(){jQuery(".commentnavi span.processing").remove();commentNavs.appendTo(".commentnavi");commentNavs=null} function ajaxPaginatePosts(c){jQuery.ajax({url:c,type:"get",dataType:"html",beforeSend:function(){postnavs=jQuery(".pagenavi").children().detach();jQuery(".pagenavi").append('<span class="processing"></span>')},complete:function(){jQuery(".pagenavi span.processing").remove()},success:function(a){contentSection=jQuery("#content");loadContent(a,contentSection,true)},error:function(){postnavs.appendTo(jQuery("pagenavi"));postnavs=null}})} function ajaxPaginateSingular(c){jQuery.ajax({url:c,type:"get",dataType:"html",beforeSend:function(){var a=jQuery(".post-pages");postnavs=a.html();a.text("").children().remove();a.append('<span class="processing"></span>')},complete:function(){jQuery(".post-pages span.processing").remove()},success:function(a){contentSection=jQuery(".entry");loadContent(a,contentSection,false)},error:function(){jQuery("post-pages").html(postnavs);postnavs=null}})} function ajaxSearch(c){jQuery.ajax({url:c,type:"get",dataType:"html",beforeSend:function(){jQuery("#search-form div").append('<span class="processing"></span>')},complete:function(){jQuery("#search-form span.processing").remove()},success:function(a){contentSection=jQuery("#content");searched&&loadContent(a,contentSection,true)},error:function(){jQuery("#search-form span.processing").remove();loadContent(contentCache,jQuery("#content"),true);searched=false}})} function loadContent(c,a,b,d){a.animate({opacity:0,height:0},500,function(){jQuery("#header").ScrollTo(500);a.empty();a.html(c);b&&jQuery("#paginator").length>0&&fixPaginator(c);processContent();fadingSlideDown(a,d)})}function fixPaginator(c){if(jQuery.browser.msie){c=c.match(/id="paginator">[\s\S]+<script[^>]+>([\s\S]+?)<\/script>/i);c!=null&&eval(c[1].match(/(pag = new.+\);)/i)[1])}} function showMessage(c,a){jQuery("#comment-form .fade").remove();jQuery("#submit-button").after('<span class="fade ajax-comment-msg">'+c+"</span>");jQuery("#comment-form .fade").delay(2E3).fadeOut(500,function(){jQuery(this).remove();a&&typeof a=="function"&&a()})} function showError(c,a){jQuery("#comment-form .fade").remove();jQuery("#submit-button").after('<span class="fade ajax-comment-error">'+c+"</span>");jQuery("#comment-form .fade").delay(2E3).fadeOut(500,function(){jQuery(this).remove();a&&typeof a=="function"&&a()})}var contentCache,searched=false; jQuery(document).ready(function(){jQuery("#comment-form").submit(function(){ajaxSubmitComment();return false});jQuery(".commentnavi a").live("click",function(){var b=jQuery(this).attr("href").split(/(\?|&)action=cpage_ajax.*$/)[0],d=1;if(/comment-page-/i.test(b))d=b.split(/comment-page-/i)[1].split(/(\/|#|&).*$/)[0];else if(/cpage=/i.test(b))d=b.split(/cpage=/i)[1].split(/(\/|#|&).*$/)[0];var e=jQuery("#cp_post_id").text(),f=b.split(/#.*$/)[0];f+=/\?/i.test(b)?"&":"?";f+="action=cpage_ajax&post="+ e+"&page="+d;ajaxPaginateComments(f);return false});jQuery(".post-pages a").live("click",function(){var b=jQuery(this).attr("href").split(/(\?|&)action=spage_ajax.*$/)[0],d=1;if(/page=/i.test(b))d=b.split(/page=/i)[1].split(/(\/|#|&).*jQuery/)[0];var e=b.split(/#.*$/)[0];e+=/\?/i.test(b)?"&":"?";e+="action=spage_ajax";/page=/i.test(e)||(e+="&page="+d);ajaxPaginateSingular(e);return false});jQuery("body.home .pagenavi a, body.archive .pagenavi a, body.search .pagenavi a").live("click",function(){var b= jQuery(this).attr("href");if(/action=/i.test(b))b=b.replace(/action=[^#&]+/ig,"action=ppage_ajax");else{b+=/\?/i.test(b)?"&":"?";b+="action=ppage_ajax"}ajaxPaginatePosts(b);return false});jQuery("#search-form").submit(function(){var b=jQuery(this).find("#s").val();b=jQuery(this).attr("action")+"?s="+encodeURIComponent(b)+"&action=search_ajax";ajaxSearch(b);return false});var c,a;jQuery("#s").keyup(function(){clearTimeout(c);c=setTimeout(function(){var b=jQuery("#s"),d=b.val();if(d.length==0){if(searched){loadContent(contentCache, jQuery("#content"),true,function(){b.focus()});jQuery("#search-form span.processing").remove();searched=false}a=d}else if(d!=a){if(!searched){contentCache=jQuery("#content")[0].innerHTML;searched=true}a=d;jQuery("#search-form").submit()}},800)})});